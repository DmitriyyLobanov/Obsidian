 2025-05-11 18:02

Паттерн для реализации "фоновой" операции выгрузки какого либо файла с данными. Со сжатием, шифрованием и отслеживанием прогресса.

Опять же, если начинать без паттерна - потом будет очень больно всё переделывать. Примеры из Twapi, выгрузка файла с сообщениями.

Тут на самом деле очень похоже на то как в нашей подсистеме реализована выгрузка файлов из СХК, только без наворотов в виде шифрований, сжатий и отслеживания прогресса. Просто есть сервис собирающий данные для наполнения конкретного шаблона файла (заявления, графики платежей, соглашения и т.д.) и формирует файл и отдаёт его в СХК, а потребителю отдаёт id по которому можно этот файл скачать.


```typescript  
// Twapi API  
abstract class Twapi {  
static version = "v1";  
static title = "Twapi API";  
// ...  
@post("/{parent=users/*}/messages:export")  
ExportMessages(req: ExportMessagesRequest): Operation<ExportMessagesResponse, ExportMessagesMetadata>;  
}  
// Помимо родителя (пользователя), ExportMessagesRequest также дополнительно получает конфигурацию выходных данных  
interface ExportMessagesRequest {  
parent: string; // родительский пользователь экспортируемых сообщений  
outputConfig: MessageOutputConfig;  
}  
// Здесь мы определяем «место назначения», где окажутся данные после завершения операции  
interface MessageOutputConfig {  
destination: Destination;  
compressionConfig?: CompressionConfig;  
encryptionConfig?: EncryptionConfig;  
}  
// Кроме того, можно настроить способ сжатия или шифрования данных, используя отдельные объекты конфигурации  
interface ExportMessagesResponse {  
outputConfig: MessageOutputConfig;  
}  
// При выводе данных в назначенное место результат будет отражать использованную конфигурацию  
interface ExportMessagesMetadata {  
progressPercent: number; // целое между 0 и 100, отражающее прогресс операции  
}

```

#Джей_Гивакс_Паттерны_проектирования_API 
#Learn
[[Системный анализ]]
[[Джей Гивакс Паттерны проектирования API]]